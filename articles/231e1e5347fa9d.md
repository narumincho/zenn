---
title: "Deno ã§ https:// ã‹ã‚‰ import ã—ã¦ã‚‚å‹•ããƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã™ã‚‹"
emoji: "ğŸŒ"
type: "tech"
topics:
  - "deno"
published: true
published_at: "2022-12-09 10:39"
---

[Deno Advent Calendar 2022](https://qiita.com/advent-calendar/2022/deno) ã®9æ—¥ç›®ã®è¨˜äº‹ã§ã™

## https:// ã‹ã‚‰ import ã§ãã‚‹ã®ã¯ã¨ã¦ã‚‚ä¾¿åˆ©

Deno ã¯ Node.js ã¨ã¯é•ã„, ç›´æ¥ `https://` ã‹ã‚‰å§‹ã¾ã‚‹URLã§TypeScript ã®ã‚³ãƒ¼ãƒ‰ã‚’ import ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™.

```tsx
import { serve } from "https://deno.land/std@0.167.0/http/server.ts";

serve(() => {
  return new Response("ä»Šã®æ™‚åˆ»ã¯" + new Date().toISOString() + "ã§ã™");
});
```

![time-server](https://storage.googleapis.com/zenn-user-upload/75e16786f84b-20221209.png)

`package.json` ãŒä¸è¦ã§æ‰‹è»½ã§ã™ã­. import ã™ã‚‹ URL ã¯ `https://deno.land` ã®ã‚ªãƒªã‚¸ãƒ³ã§ã‚ã‚‹å¿…è¦ã‚‚ãªã, HTTP ã¨ã—ã¦Webã«å…¬é–‹ã—ã¦ã„ã‚Œã°, ã©ã“ã‹ã‚‰ã§ã‚‚ import ã§ãã¾ã™. npm registry ãªã©ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“.

1ç•ªæ‰‹è»½ã«å…¬é–‹ã§ãã‚‹ã®ã¯ GitHub ã§ã—ã‚‡ã†.

GitHub ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒšãƒ¼ã‚¸ã® Raw ãƒœã‚¿ãƒ³ã‹ã‚‰ç§»å‹•ã§ãã‚‹ ã‚³ãƒ¼ãƒ‰ã ã‘ã‚’è¿”ã™URLã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™.

![raw-url](https://storage.googleapis.com/zenn-user-upload/58c00759e72d-20221209.png)

ä¾‹ [`https://raw.githubusercontent.com/narumincho/deno-https-import-test/main/sampleServer.ts`](https://raw.githubusercontent.com/narumincho/deno-https-import-test/main/sampleServer.ts)

ãŸã  ã“ã® URL ã«ã¯ commit hash ãŒå…¥ã£ã¦ã„ãªã„ãŸã‚, main ãƒ–ãƒ©ãƒ³ãƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸã‚‰å†…å®¹ãŒå¤‰ã‚ã£ã¦ã—ã¾ã„ã¾ã™. Deno ã¯ 1åº¦ import ã—ãŸã‚‚ã®ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œ, æ›´æ–°ã™ã‚‹ã®ãŒå°‘ã—é¢å€’ãªã®ã¨, ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«å†…å®¹ãŒå¤‰ã‚ã£ã¦ã—ã¾ã†ã¨é–‹ç™ºæ™‚ã«å‹•ã„ãŸã‚‚ã®ã¨å¤‰ã‚ã£ã¦ã—ã¾ã†ã®ã§, ã€ŒCopy Permalinkã€ã§ã‚³ãƒ”ãƒ¼ã—ãŸ commit hash ãŒå«ã¾ã‚Œã‚‹ URL ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€ŒRawã€ãƒœã‚¿ãƒ³ã§URLã‚’å¾—ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†.

```tsx
import { main } from "https://raw.githubusercontent.com/narumincho/deno-https-import-test/01c08b708bb21abdcda420eb1673a91ea1997678/sampleServer.ts";

main();
```

![http-server-from-github](https://storage.googleapis.com/zenn-user-upload/c557782c1e81-20221209.png)

[`https://raw.githubusercontent.com/narumincho/deno-https-import-test/01c08b708bb21abdcda420eb1673a91ea1997678/sampleServer.ts`](https://raw.githubusercontent.com/narumincho/deno-https-import-test/01c08b708bb21abdcda420eb1673a91ea1997678/sampleServer.ts) ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ç›¸å¯¾ãƒ‘ã‚¹ã§æŒ‡å®šã—ã¦ã¾ã™ãŒ, ã†ã¾ãå–å¾—ã—ã¦ãã‚Œã¾ã™.

https://github.com/narumincho/deno-https-import-test/blob/01c08b708bb21abdcda420eb1673a91ea1997678/sampleServer.ts#L2


ã¾ãŸ, Deno Doc ã« URL ã‚’å…¥ã‚Œã‚‹ã¨ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™. API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä»•çµ„ã¿ã‚’ã‚ã–ã‚ã–ç”¨æ„ã—ãªãã¦è‰¯ã„ã§ã™ã­. 

https://doc.deno.land/https://raw.githubusercontent.com/narumincho/deno-https-import-test/01c08b708bb21abdcda420eb1673a91ea1997678/sampleServer.ts

![deno-doc](https://storage.googleapis.com/zenn-user-upload/e92b6c886e42-20221209.png)

:::message
ã‚ã¨ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒãªã®ãŒè‰¯ã„ `deno.land` ã®APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ([https://deno.land/std@0.167.0](https://deno.land/std@0.167.0) ) ã‚‚ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã«å¯¾å¿œã—ã¦ãã‚Œãªã„ã‹ãªãƒ¼
:::

ã“ã® `https://` ã§å§‹ã¾ã‚‹URL ã§ import ã—ã¦å‹•ã‹ã›ã‚‹æ©Ÿèƒ½ã§ã™ãŒ, ã†ã¾ãå‹•ã‹ãªã„å ´åˆãŒã‚ã‚Šã¾ã™.

## import map ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ

import map ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰

https://github.com/narumincho/deno-https-import-test/blob/7c9a2c1caed59fcec84a794f266f23a59b84b111/useImportMap.ts


ä½¿ã†å´

```ts
import { startUseImportMapHttpServer } from "https://raw.githubusercontent.com/narumincho/deno-https-import-test/d9c961328aff4e3512a550ac022fbccebdd988df/useImportMap.ts";

startUseImportMapHttpServer();
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã“ã®ã‚ˆã†ãª import ã®ãƒ‘ã‚¹ãŒè§£æ±ºã§ããªã„ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™. (ãŸã¾ãŸã¾åŒã˜æŒ‡å®šã® import map ã‚’ä½¿ã£ã¦ã„ã‚Œã°ã‚¨ãƒ©ãƒ¼ã¯ç™ºç”Ÿã—ãªã„)

```
PS C:\Users\narum\Documents\GitHub\deno-https-import-test> deno run --allow-net=:8000 ./start.ts
error: Relative import path "std/http/server.ts" not prefixed with / or ./ or ../
    at https://raw.githubusercontent.com/narumincho/deno-https-import-test/d9c961328aff4e3512a550ac022fbccebdd988df/useImportMap.ts:1:23
```

GitHub ã§å…¬é–‹ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥ä½¿ã„ãŸã„ã¨ãã«ã¯ import map ã‚’ä½¿ã‚ãšã«ç›´æ¥ import ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†.


## ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šã‚’ã—ã¦ã„ã‚‹å ´åˆ

ä»Šåº¦ã¯ HTTP ã‚µãƒ¼ãƒãƒ¼ã§ç”»åƒã‚’è¿”ã™ä¾‹ã§ã™

https://github.com/narumincho/deno-https-import-test/blob/83d95134eafb394556f3b39de6255a7caf0bcd2a/imageServerUseReadFile.ts

- `import.meta.resolve` ã‚’ä½¿ã£ã¦ã„ã‚‹ç†ç”±ã¯, ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŸºæº–ã¨ã—ãŸç›¸å¯¾ãƒ‘ã‚¹ã§æŒ‡å®šã™ã‚‹ãŸã‚ã§ã™. ãã†ã—ãªã„ã¨ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŸºæº–ã«ãªã£ã¦ã—ã¾ã„ã¾ã™
- `new URL` ã‚’ä½¿ã£ã¦ã„ã‚‹ç†ç”±ã¯, `file://` ã‹ã‚‰å§‹ã¾ã‚‹æ–‡å­—åˆ—ã«ã¯è¤‡æ•°ã®è§£é‡ˆãŒã‚ã‚‹ãŸã‚ã¿ãŸã„ã§ã™. é–¢é€£ issue â†“

 https://github.com/denoland/deno/issues/8579


ä½¿ã†å´

```ts
import { startDenoImageServer } from "https://raw.githubusercontent.com/narumincho/deno-https-import-test/83d95134eafb394556f3b39de6255a7caf0bcd2a/imageServerUseReadFile.ts";

startDenoImageServer();
```

ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦å‹•ã‹ã›ã°å•é¡Œãªãå‹•ãã®ã§ã™ãŒ, GitHub ã® `https://` ã§importã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã¯ ã“ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œ ã†ã¾ãå‹•ãã¾ã›ã‚“

```
PS C:\Users\narum\Documents\GitHub\deno-https-import-test> deno run --allow-net=:8000 ./start.tserror: Uncaught (in promise) TypeError: Must be a file URL.
    throw new TypeError("Must be a file URL.");
          ^
    at fromFileUrl (https://deno.land/std@0.167.0/path/win32.ts:968:11)    at startDenoImageServer (https://raw.githubusercontent.com/narumincho/deno-https-import-test/7c9a2c1caed59fcec84a794f266f23a59b84b111/imageServerUseReadFile.ts:9:5)    at file:///C:/Users/narum/Documents/GitHub/deno-https-import-test/start.ts:3:1
```

`Deno.readFile` ã§ã¯ãªã `fetch` ã‚’ä½¿ã†ã“ã¨ã§å¯¾å‡¦ã§ãã¾ã™. `fetch` ã¯ `https://` ã‹ã‚‰å§‹ã¾ã‚‹URLä»¥å¤–ã«ã‚‚, `import.meta.url` ãªã©ã§å–å¾—ã§ãã‚‹ `file://` ã‹ã‚‰å§‹ã¾ã‚‹URLã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™. 

ã¡ãªã¿ã«HTTPã® POST ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã¯ã§ãã¾ã›ã‚“. ã§ãã‚‹ã®ã¯ HTTPã®GETãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã§ã™

https://github.com/narumincho/deno-https-import-test/blob/83d95134eafb394556f3b39de6255a7caf0bcd2a/imageServerUseFetch.ts

```ts
import { startDenoImageServer } from "https://raw.githubusercontent.com/narumincho/deno-https-import-test/83d95134eafb394556f3b39de6255a7caf0bcd2a/imageServerUseFetch.ts";

startDenoImageServer();
```

ã“ã‚Œã§, `https://` ã‹ã‚‰å§‹ã¾ã‚‹URLã§ import ã—ã¦ã‚‚å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

![deno-image-server](https://storage.googleapis.com/zenn-user-upload/cabf7845ea9b-20221209.png)

ã¾ãŸ, å®Ÿè¡Œæ™‚ã«ç”»åƒã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ãŸã‚å®Ÿè¡Œã«ã¯

```powershell
deno run --allow-net=:8000,raw.githubusercontent.com ./start.ts
```

ã®ã‚ˆã†ã« `--allow-net` ãƒ•ãƒ©ã‚°ã« `raw.githubusercontent.com` ã®æŒ‡å®šã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™. (`:8000` ã®æŒ‡å®šã¯HTTPã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã®ãŸã‚)

:::message
ã“ã®ãƒ•ãƒ©ã‚°ã‚’æŒ‡å®šã—ãªã„ã¨è¡Œã‘ãªã„å•é¡Œã¯, [ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼7æ—¥ç›®](https://zenn.dev/hashrock/articles/dbd868e390d60f) ã® imagescript ã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã« `--allow-net=deno.land` ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã‚‚ç™ºç”Ÿã—ã¦ã„ã¾ã™.



imagescript ã¯[ã“ã“](https://deno.land/x/imagescript@1.2.15/utils/wasm/svg.js?source#L6) ã§ WebAssembly ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ fetch ã‹ Deno.readFile ã§ import ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ ( `fetch` ã¯ `file://` ã«å¯¾å¿œã—ã¦ã„ã‚‹ãŸã‚åˆ†å²ã¯ä¸è¦ã ãŒæ˜”ã¯å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã‹ãª )
:::

https://zenn.dev/hashrock/articles/dbd868e390d60f

https://deno.land/x/imagescript@1.2.15/utils/wasm/svg.js?source#L6

ã“ã®ãƒ•ãƒ©ã‚°ã®æŒ‡å®šã‚’ã—ãªãã¦æ¸ˆã¿, ã¾ãŸãƒãƒƒãƒˆã«æ¥ç¶šã—ã¦ã„ãªã„ã¨ãã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ç”»åƒã‚’ã‚³ãƒ¼ãƒ‰ã«åŸ‹ã‚è¾¼ã‚€ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™


> ã“ã®è¨˜äº‹ã‚‚ä¼¼ãŸã‚ˆã†ãªã“ã¨ã‚’ã—ã¦ã„ã¾ã™

https://www.ccbaxy.xyz/blog/2021/06/05/js18/#deno-deploy-yong-nohuairuwo-bundle-sitemiru



png ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ json ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã—ã¦ä¿å­˜ã™ã‚‹ã‚³ãƒ¼ãƒ‰

https://github.com/narumincho/deno-https-import-test/blob/83d95134eafb394556f3b39de6255a7caf0bcd2a/embedDenoPng.ts

json ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã£ãŸ `deno.png`

https://github.com/narumincho/deno-https-import-test/blob/83d95134eafb394556f3b39de6255a7caf0bcd2a/deno.png.json

åŸ‹ã‚è¾¼ã¾ã‚ŒãŸ json ã‚’ import ã—ã¦å‹•ä½œã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã®ã‚³ãƒ¼ãƒ‰

https://github.com/narumincho/deno-https-import-test/blob/83d95134eafb394556f3b39de6255a7caf0bcd2a/imageServerUseJsonImport.ts

```ts
import { startDenoImageServer } from "https://raw.githubusercontent.com/narumincho/deno-https-import-test/83d95134eafb394556f3b39de6255a7caf0bcd2a/imageServerUseJsonImport.ts";

startDenoImageServer();
```

ã“ã‚Œã§, `--allow-net` ã«ä½™è¨ˆãªæŒ‡å®šã‚’ã—ãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

```powershell:start.ts
deno run --allow-net=:8000 ./start.ts
```

æ¬ ç‚¹ã¯ç”»åƒã‚’å¤‰æ›´ã—ãŸã¨ãã«å¤‰æ›´ã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã« jsonã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ GitHub ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ‰‹é–“ãŒã‚ã‚‹ã“ã¨ã§ã™. ãã“ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã®ã¯ã¾ãŸä»Šåº¦ãƒ¼